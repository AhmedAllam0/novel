{
  "name": "ğŸ“š Book Recommendations Engine",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "book-recommendations",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
      "name": "Webhook Input",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [0, 0],
      "webhookId": "book-rec-webhook-001"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "bookName",
              "value": "={{ $json.bookName || $json.query || $json.input }}",
              "type": "string"
            },
            {
              "id": "2",
              "name": "userPreferences",
              "value": "={{ $json.preferences || '' }}",
              "type": "string"
            },
            {
              "id": "3",
              "name": "language",
              "value": "={{ $json.language || 'ar' }}",
              "type": "string"
            },
            {
              "id": "4",
              "name": "count",
              "value": "={{ $json.count || 5 }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "id": "b2c3d4e5-f6g7-8901-2345-67890abcdef0",
      "name": "Extract Input Data",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [240, 0]
    },
    {
      "parameters": {
        "model": "mistral-large-latest",
        "options": {
          "temperature": 0.5,
          "maxTokens": 2000
        }
      },
      "id": "c3d4e5f6-g7h8-9012-3456-7890abcdef01",
      "name": "Mistral AI Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
      "typeVersion": 1,
      "position": [480, 160],
      "credentials": {
        "mistralCloudApi": {
          "id": "8RlFJeQEIK1RW3KX",
          "name": "Mistral Cloud account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Ø£ÙˆØµÙŠ Ø¨ {{ $('Extract Input Data').item.json.count }} ÙƒØªØ¨ Ù…Ø´Ø§Ø¨Ù‡Ø© Ù„Ù€ \"{{ $('Extract Input Data').item.json.bookName }}\"\n\nØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {{ $('Extract Input Data').item.json.userPreferences || 'Ø¨Ø¯ÙˆÙ† ØªÙØ¶ÙŠÙ„Ø§Øª Ù…Ø­Ø¯Ø¯Ø©' }}\n\nÙ‚Ø¯Ù… Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ù„ÙŠ:\n\nğŸ“š <b>ØªÙˆØµÙŠØ§Øª ÙƒØªØ¨ Ù…Ø´Ø§Ø¨Ù‡Ø©</b>\n\n1ï¸âƒ£ <b>[Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ø£ÙˆÙ„]</b>\nğŸ‘¤ Ø§Ù„Ù…Ø¤Ù„Ù: [Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ù„Ù]\nğŸ“– Ø§Ù„Ù†ÙˆØ¹: [Ù†ÙˆØ¹ Ø§Ù„ÙƒØªØ§Ø¨]\nâ­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: [Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù…Ù† 5]\nğŸ” Ø§Ù„Ø³Ø¨Ø¨: [Ù„Ù…Ø§Ø°Ø§ Ù‡Ùˆ Ù…Ø´Ø§Ø¨Ù‡ - Ø³Ø·Ø± ÙˆØ§Ø­Ø¯]\n\n2ï¸âƒ£ ...\n\nÙ…Ù„Ø§Ø­Ø¸Ø§Øª:\n- Ø§Ø³ØªØ®Ø¯Ù… HTML ÙÙ‚Ø· (<b>ØŒ <i>ØŒ <a>)\n- Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Markdown Ø£Ø¨Ø¯Ø§Ù‹\n- ÙƒÙ† Ø¯Ù‚ÙŠÙ‚Ø§Ù‹ ÙÙŠ Ø§Ù„ØªÙˆØµÙŠØ§Øª\n- Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ø£ØµÙ„ÙŠ Ø¹Ø±Ø¨ÙŠØ§Ù‹",
        "options": {
          "systemMessage": "Ø£Ù†Øª Ø®Ø¨ÙŠØ± ÙÙŠ Ø§Ù„Ø£Ø¯Ø¨ Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¹Ø§Ù„Ù…ÙŠ. Ù…Ù‡Ù…ØªÙƒ ØªÙ‚Ø¯ÙŠÙ… ØªÙˆØµÙŠØ§Øª ÙƒØªØ¨ Ø¯Ù‚ÙŠÙ‚Ø© ÙˆÙ…Ù†Ø§Ø³Ø¨Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰:\n1. Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ\n2. ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\n3. Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¯Ø¨ÙŠ\n4. Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„ÙƒØªØ§Ø¨ÙŠ\n\nÙ‚Ø¯Ù… ØªÙˆØµÙŠØ§Øª Ù…ØªÙ†ÙˆØ¹Ø© ØªØ´Ù…Ù„:\n- ÙƒØªØ¨ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¯Ø¨ÙŠ\n- ÙƒØªØ¨ Ù„Ù†ÙØ³ Ø§Ù„Ù…Ø¤Ù„Ù\n- ÙƒØªØ¨ Ø¨Ø£Ø³Ù„ÙˆØ¨ Ù…Ø´Ø§Ø¨Ù‡\n- ÙƒØªØ¨ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ø­Ù‚Ø¨Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©\n\nØ§Ø³ØªØ®Ø¯Ù… HTML ÙÙ‚Ø· Ù„Ù„ØªÙ†Ø³ÙŠÙ‚ (Ù„ÙŠØ³ Markdown)."
        }
      },
      "id": "d4e5f6g7-h8i9-0123-4567-890abcdef012",
      "name": "Generate Recommendations",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.4,
      "position": [480, 0]
    },
    {
      "parameters": {
        "jsCode": "// Format recommendations response\nconst inputData = $input.first().json;\nconst bookName = $('Extract Input Data').item.json.bookName;\n\nlet responseText = '';\n\nif (inputData.response) {\n  responseText = inputData.response;\n} else if (inputData.output) {\n  responseText = inputData.output;\n} else if (inputData.text) {\n  responseText = inputData.text;\n} else {\n  responseText = 'âŒ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª.';\n}\n\n// Convert Markdown to HTML if needed\nresponseText = responseText.replace(/\\*\\*(.+?)\\*\\*/g, '<b>$1</b>');\nresponseText = responseText.replace(/(?<!\\*)\\*(?!\\*)(.+?)(?<!\\*)\\*(?!\\*)/g, '<i>$1</i>');\nresponseText = responseText.replace(/__(.+?)__/g, '<b>$1</b>');\n\n// Add footer\nresponseText += '\\n\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nğŸ’¡ <i>Ø§Ø·Ù„Ø¨ ØªÙˆØµÙŠØ§Øª Ù„ÙƒØªØ¨ Ø£Ø®Ø±Ù‰ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª!</i>';\n\n// Extract book recommendations as structured data\nconst recommendations = [];\nconst bookPattern = /\\d+[ï¸âƒ£\\)\\.]\\s*<b>(.+?)<\\/b>[\\s\\S]*?ğŸ‘¤\\s*Ø§Ù„Ù…Ø¤Ù„Ù:\\s*(.+?)\\n[\\s\\S]*?ğŸ“–\\s*Ø§Ù„Ù†ÙˆØ¹:\\s*(.+?)\\n[\\s\\S]*?â­\\s*Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:\\s*(.+?)\\n/g;\n\nlet match;\nwhile ((match = bookPattern.exec(responseText)) !== null) {\n  recommendations.push({\n    title: match[1].trim(),\n    author: match[2].trim(),\n    genre: match[3].trim(),\n    rating: match[4].trim()\n  });\n}\n\nreturn [{\n  json: {\n    text: responseText,\n    parse_mode: 'HTML',\n    recommendations: recommendations,\n    baseBook: bookName,\n    count: recommendations.length\n  }\n}];"
      },
      "id": "e5f6g7h8-i9j0-1234-5678-90abcdef0123",
      "name": "Format Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [720, 0]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "id": "f6g7h8i9-j0k1-2345-6789-0abcdef01234",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [960, 0]
    }
  ],
  "connections": {
    "Webhook Input": {
      "main": [
        [
          {
            "node": "Extract Input Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Input Data": {
      "main": [
        [
          {
            "node": "Generate Recommendations",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mistral AI Model": {
      "ai_languageModel": [
        [
          {
            "node": "Generate Recommendations",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Generate Recommendations": {
      "main": [
        [
          {
            "node": "Format Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Response": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "tags": []
}
