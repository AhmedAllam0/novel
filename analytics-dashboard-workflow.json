{
  "name": "ğŸ“Š Analytics & Monitoring Dashboard",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "analytics-dashboard",
        "options": {}
      },
      "id": "webhook-input",
      "name": "Webhook Input",
      "type": "n8n-nodes-base.webhook",
      "position": [200, 300],
      "webhookId": "analytics-dashboard-webhook",
      "typeVersion": 1
    },
    {
      "parameters": {
        "jsCode": "// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// ğŸ“Š Analytics Data Extractor\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst input = $input.first().json;\nconst action = input.action || 'log';\n\n// Extract event data\nconst eventData = {\n  action: action,\n  timestamp: new Date().toISOString(),\n  userId: input.userId || null,\n  sessionId: input.sessionId || null,\n  eventType: input.eventType || 'unknown',\n  \n  // User data\n  userData: {\n    firstName: input.firstName || null,\n    username: input.username || null,\n    language: input.language || 'ar',\n    chatType: input.chatType || 'private'\n  },\n  \n  // Event-specific data\n  eventData: {\n    bookName: input.bookName || null,\n    searchQuery: input.searchQuery || null,\n    workflowUsed: input.workflowUsed || null,\n    responseTime: input.responseTime || null,\n    success: input.success !== false,\n    errorMessage: input.errorMessage || null,\n    linksCount: input.linksCount || 0,\n    buttonClicked: input.buttonClicked || null\n  },\n  \n  // Metadata\n  metadata: {\n    source: input.source || 'telegram',\n    version: '1.0.0',\n    environment: input.environment || 'production'\n  }\n};\n\nconsole.log('ğŸ“Š Analytics Event:', JSON.stringify(eventData, null, 2));\n\nreturn [{ json: eventData }];"
      },
      "id": "extract-data",
      "name": "Extract Analytics Data",
      "type": "n8n-nodes-base.code",
      "position": [400, 300],
      "typeVersion": 2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false
          },
          "conditions": [
            {
              "id": "route-stats",
              "leftValue": "={{ $json.action }}",
              "rightValue": "get_stats",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "route-log",
              "leftValue": "={{ $json.action }}",
              "rightValue": "log",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "route-report",
              "leftValue": "={{ $json.action }}",
              "rightValue": "generate_report",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "route-action",
      "name": "Route by Action",
      "type": "n8n-nodes-base.switch",
      "position": [600, 300],
      "typeVersion": 3
    },
    {
      "parameters": {
        "jsCode": "// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// ğŸ“ˆ Generate Statistics Report\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst input = $input.first().json;\nconst timeRange = input.timeRange || '24h';\n\n// Simulated statistics (in production, this would query a database)\nconst stats = {\n  timeRange: timeRange,\n  generatedAt: new Date().toISOString(),\n  \n  // Overall metrics\n  overall: {\n    totalUsers: 1247,\n    activeUsers: 892,\n    totalSearches: 5634,\n    totalDownloads: 3421,\n    successRate: 87.4,\n    averageResponseTime: 3.2\n  },\n  \n  // User engagement\n  engagement: {\n    newUsers: 127,\n    returningUsers: 765,\n    averageSessionDuration: 245,\n    messagesPerUser: 6.3,\n    retentionRate: 68.5\n  },\n  \n  // Popular content\n  topBooks: [\n    { title: '1984', author: 'George Orwell', searches: 234 },\n    { title: 'Ø§Ù„Ø®ÙŠÙ…ÙŠØ§Ø¦ÙŠ', author: 'Paulo Coelho', searches: 189 },\n    { title: 'Ù…Ø¦Ø© Ø¹Ø§Ù… Ù…Ù† Ø§Ù„Ø¹Ø²Ù„Ø©', author: 'Gabriel GarcÃ­a MÃ¡rquez', searches: 156 },\n    { title: 'Ø§Ù„Ù†Ø¨ÙŠ', author: 'Khalil Gibran', searches: 143 },\n    { title: 'Ø§Ù„Ø¨Ø¤Ø³Ø§Ø¡', author: 'Victor Hugo', searches: 128 }\n  ],\n  \n  // Popular genres\n  topGenres: [\n    { genre: 'Ø±ÙˆØ§ÙŠØ©', count: 2341 },\n    { genre: 'ÙÙ„Ø³ÙØ©', count: 891 },\n    { genre: 'ØªÙ†Ù…ÙŠØ© Ø¨Ø´Ø±ÙŠØ©', count: 678 },\n    { genre: 'ØªØ§Ø±ÙŠØ®', count: 543 },\n    { genre: 'Ø£Ø¯Ø¨ Ø¹Ø§Ù„Ù…ÙŠ', count: 432 }\n  ],\n  \n  // Workflow usage\n  workflowUsage: [\n    { workflow: 'book-download', uses: 3421, successRate: 89.2 },\n    { workflow: 'book-recommendations', uses: 1234, successRate: 95.6 },\n    { workflow: 'book-metadata', uses: 876, successRate: 93.1 },\n    { workflow: 'book-quotes', uses: 654, successRate: 97.3 },\n    { workflow: 'author-profile', uses: 543, successRate: 94.8 },\n    { workflow: 'reading-list', uses: 432, successRate: 98.1 }\n  ],\n  \n  // Performance metrics\n  performance: {\n    averageResponseTime: 3.2,\n    p95ResponseTime: 5.8,\n    p99ResponseTime: 8.3,\n    errorRate: 2.1,\n    timeoutRate: 0.4\n  },\n  \n  // Errors tracking\n  topErrors: [\n    { error: 'Book not found', count: 234, percentage: 45.2 },\n    { error: 'API timeout', count: 123, percentage: 23.7 },\n    { error: 'Invalid format', count: 89, percentage: 17.2 },\n    { error: 'Rate limit exceeded', count: 72, percentage: 13.9 }\n  ],\n  \n  // User languages\n  userLanguages: [\n    { language: 'ar', users: 892, percentage: 71.5 },\n    { language: 'en', users: 234, percentage: 18.8 },\n    { language: 'fr', users: 89, percentage: 7.1 },\n    { language: 'other', users: 32, percentage: 2.6 }\n  ],\n  \n  // Time-based activity\n  hourlyActivity: [\n    { hour: '00:00', requests: 34 },\n    { hour: '01:00', requests: 23 },\n    { hour: '02:00', requests: 12 },\n    { hour: '03:00', requests: 8 },\n    { hour: '04:00', requests: 15 },\n    { hour: '05:00', requests: 28 },\n    { hour: '06:00', requests: 56 },\n    { hour: '07:00', requests: 89 },\n    { hour: '08:00', requests: 156 },\n    { hour: '09:00', requests: 234 },\n    { hour: '10:00', requests: 289 },\n    { hour: '11:00', requests: 312 },\n    { hour: '12:00', requests: 345 },\n    { hour: '13:00', requests: 367 },\n    { hour: '14:00', requests: 398 },\n    { hour: '15:00', requests: 423 },\n    { hour: '16:00', requests: 456 },\n    { hour: '17:00', requests: 489 },\n    { hour: '18:00', requests: 512 },\n    { hour: '19:00', requests: 534 },\n    { hour: '20:00', requests: 489 },\n    { hour: '21:00', requests: 423 },\n    { hour: '22:00', requests: 345 },\n    { hour: '23:00', requests: 234 }\n  ]\n};\n\nconsole.log('ğŸ“Š Statistics generated');\n\nreturn [{ json: stats }];"
      },
      "id": "generate-stats",
      "name": "Generate Statistics",
      "type": "n8n-nodes-base.code",
      "position": [800, 200],
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// ğŸ“ Log Event to Analytics\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst eventData = $input.first().json;\n\n// In production, this would store to a database\n// For now, we'll just log and acknowledge\n\nconsole.log('ğŸ“ Logging analytics event:');\nconsole.log('  Event Type:', eventData.eventType);\nconsole.log('  User ID:', eventData.userId);\nconsole.log('  Timestamp:', eventData.timestamp);\nconsole.log('  Success:', eventData.eventData.success);\n\nif (eventData.eventData.bookName) {\n  console.log('  Book:', eventData.eventData.bookName);\n}\n\nif (eventData.eventData.errorMessage) {\n  console.log('  Error:', eventData.eventData.errorMessage);\n}\n\nconst response = {\n  success: true,\n  message: 'Event logged successfully',\n  eventId: `evt_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n  timestamp: eventData.timestamp\n};\n\nreturn [{ json: response }];"
      },
      "id": "log-event",
      "name": "Log Event",
      "type": "n8n-nodes-base.code",
      "position": [800, 300],
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// ğŸ“„ Generate Detailed Report\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst input = $input.first().json;\nconst reportType = input.reportType || 'summary';\nconst format = input.format || 'html';\n\n// Generate comprehensive report\nconst report = {\n  reportType: reportType,\n  format: format,\n  generatedAt: new Date().toISOString(),\n  period: {\n    start: new Date(Date.now() - 24*60*60*1000).toISOString(),\n    end: new Date().toISOString()\n  }\n};\n\nif (format === 'html') {\n  report.html = generateHTMLReport(reportType);\n  report.text = report.html;\n} else {\n  report.data = generateDataReport(reportType);\n}\n\nfunction generateHTMLReport(type) {\n  return `\nğŸ“Š <b>ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª - Bot Find Links to Download Books</b>\n\nğŸ“… <b>Ø§Ù„ÙØªØ±Ø©:</b> Ø¢Ø®Ø± 24 Ø³Ø§Ø¹Ø©\nğŸ• <b>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</b> ${new Date().toLocaleString('ar-EG')}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ“ˆ <b>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©</b>\n\nğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: <b>1,247</b>\nâœ… Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù†Ø´Ø·ÙˆÙ†: <b>892</b> (71.5%)\nğŸ” Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨Ø­Ø«: <b>5,634</b>\nğŸ“¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª: <b>3,421</b>\nâœ¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: <b>87.4%</b>\nâš¡ Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: <b>3.2 Ø«Ø§Ù†ÙŠØ©</b>\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ“š <b>Ø£ÙƒØ«Ø± Ø§Ù„ÙƒØªØ¨ Ø¨Ø­Ø«Ø§Ù‹</b>\n\n1ï¸âƒ£ <b>1984</b> - George Orwell\n   ğŸ” Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø¨Ø­Ø«: 234\n\n2ï¸âƒ£ <b>Ø§Ù„Ø®ÙŠÙ…ÙŠØ§Ø¦ÙŠ</b> - Paulo Coelho\n   ğŸ” Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø¨Ø­Ø«: 189\n\n3ï¸âƒ£ <b>Ù…Ø¦Ø© Ø¹Ø§Ù… Ù…Ù† Ø§Ù„Ø¹Ø²Ù„Ø©</b> - Gabriel GarcÃ­a MÃ¡rquez\n   ğŸ” Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø¨Ø­Ø«: 156\n\n4ï¸âƒ£ <b>Ø§Ù„Ù†Ø¨ÙŠ</b> - Khalil Gibran\n   ğŸ” Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø¨Ø­Ø«: 143\n\n5ï¸âƒ£ <b>Ø§Ù„Ø¨Ø¤Ø³Ø§Ø¡</b> - Victor Hugo\n   ğŸ” Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø¨Ø­Ø«: 128\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ¯ <b>Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙŠØ²Ø§Øª</b>\n\nğŸ“¥ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„: <b>3,421</b> (89.2% Ù†Ø¬Ø§Ø­)\nâ­ ØªÙˆØµÙŠØ§Øª Ø§Ù„ÙƒØªØ¨: <b>1,234</b> (95.6% Ù†Ø¬Ø§Ø­)\nğŸ“– Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙƒØªØ¨: <b>876</b> (93.1% Ù†Ø¬Ø§Ø­)\nğŸ’­ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª: <b>654</b> (97.3% Ù†Ø¬Ø§Ø­)\nâœï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¤Ù„ÙÙŠÙ†: <b>543</b> (94.8% Ù†Ø¬Ø§Ø­)\nğŸ“ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: <b>432</b> (98.1% Ù†Ø¬Ø§Ø­)\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸŒ <b>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©</b>\n\nğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©: <b>892</b> (71.5%)\nğŸ‡¬ğŸ‡§ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©: <b>234</b> (18.8%)\nğŸ‡«ğŸ‡· Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©: <b>89</b> (7.1%)\nğŸŒ Ù„ØºØ§Øª Ø£Ø®Ø±Ù‰: <b>32</b> (2.6%)\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâš¡ <b>Ø§Ù„Ø£Ø¯Ø§Ø¡</b>\n\nâ±ï¸ Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: <b>3.2 Ø«Ø§Ù†ÙŠØ©</b>\nğŸ“Š P95 ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: <b>5.8 Ø«Ø§Ù†ÙŠØ©</b>\nğŸ“Š P99 ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: <b>8.3 Ø«Ø§Ù†ÙŠØ©</b>\nâŒ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡: <b>2.1%</b>\nâ° Ù…Ø¹Ø¯Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù„Ø©: <b>0.4%</b>\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ‘¥ <b>ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</b>\n\nğŸ†• Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø¬Ø¯Ø¯: <b>127</b>\nğŸ”„ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø¹Ø§Ø¦Ø¯ÙˆÙ†: <b>765</b>\nâ±ï¸ Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©: <b>245 Ø«Ø§Ù†ÙŠØ©</b>\nğŸ’¬ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…: <b>6.3</b>\nğŸ“ˆ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸: <b>68.5%</b>\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ• <b>Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ©</b>\n\nğŸŒ… Ø§Ù„ØµØ¨Ø§Ø­ (6-12): Ù…ØªÙˆØ³Ø·\nâ˜€ï¸ Ø§Ù„Ø¸Ù‡Ø± (12-18): Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹ (Ø°Ø±ÙˆØ©: 16:00)\nğŸŒ™ Ø§Ù„Ù…Ø³Ø§Ø¡ (18-24): Ù…Ø±ØªÙØ¹\nğŸŒƒ Ø§Ù„Ù„ÙŠÙ„ (0-6): Ù…Ù†Ø®ÙØ¶\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâœ… <b>Ø§Ù„Ø®Ù„Ø§ØµØ©</b>\n\nØ§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø¨ÙƒÙØ§Ø¡Ø© Ø¹Ø§Ù„ÙŠØ© Ù…Ø¹ Ù…Ø¹Ø¯Ù„ Ù†Ø¬Ø§Ø­ 87.4%\nÙ†Ù…Ùˆ Ù…Ø³ØªÙ…Ø± ÙÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†\nØ£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø² Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª\nØ£ÙˆÙ‚Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø¶Ù…Ù† Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n<i>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</i>\n`;\n}\n\nfunction generateDataReport(type) {\n  return {\n    summary: 'Analytics report data',\n    metrics: {\n      users: 1247,\n      searches: 5634,\n      success_rate: 87.4\n    }\n  };\n}\n\nconsole.log('ğŸ“„ Report generated:', reportType);\n\nreturn [{ json: report }];"
      },
      "id": "generate-report",
      "name": "Generate Report",
      "type": "n8n-nodes-base.code",
      "position": [800, 400],
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// ğŸ¨ Format Analytics Response\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst input = $input.first().json;\nconst action = input.action || input.reportType || 'log';\n\nlet response = {\n  success: true,\n  action: action,\n  timestamp: new Date().toISOString()\n};\n\nif (input.overall) {\n  // Statistics response\n  response.text = formatStatsAsHTML(input);\n  response.parse_mode = 'HTML';\n  response.stats = input;\n} else if (input.html) {\n  // Report response\n  response.text = input.html;\n  response.parse_mode = 'HTML';\n  response.report = input;\n} else {\n  // Event log response\n  response.text = `âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¯Ø« Ø¨Ù†Ø¬Ø§Ø­\\n\\nğŸ†” Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø¯Ø«: ${input.eventId}\\nğŸ• Ø§Ù„ÙˆÙ‚Øª: ${new Date(input.timestamp).toLocaleString('ar-EG')}`;\n  response.eventId = input.eventId;\n}\n\nfunction formatStatsAsHTML(stats) {\n  return `\nğŸ“Š <b>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</b>\n\nğŸ‘¥ <b>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†:</b>\nâ€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${stats.overall.totalUsers}\nâ€¢ Ù†Ø´Ø·: ${stats.overall.activeUsers}\n\nğŸ” <b>Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨Ø­Ø«:</b>\nâ€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${stats.overall.totalSearches}\nâ€¢ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: ${stats.overall.successRate}%\n\nğŸ“š <b>Ø£ÙƒØ«Ø± Ø§Ù„ÙƒØªØ¨ Ø¨Ø­Ø«Ø§Ù‹:</b>\n${stats.topBooks.map((book, i) => `${i+1}. ${book.title} (${book.searches})`).join('\\n')}\n\nâš¡ <b>Ø§Ù„Ø£Ø¯Ø§Ø¡:</b>\nâ€¢ ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: ${stats.overall.averageResponseTime}s\nâ€¢ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡: ${stats.performance.errorRate}%\n\n<i>Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„ØŒ Ø§Ø³ØªØ®Ø¯Ù… generate_report</i>\n`;\n}\n\nreturn [{ json: response }];"
      },
      "id": "format-response",
      "name": "Format Response",
      "type": "n8n-nodes-base.code",
      "position": [1000, 300],
      "typeVersion": 2
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {}
      },
      "id": "respond-webhook",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [1200, 300],
      "typeVersion": 1
    }
  ],
  "connections": {
    "Webhook Input": {
      "main": [[{ "node": "Extract Analytics Data", "type": "main", "index": 0 }]]
    },
    "Extract Analytics Data": {
      "main": [[{ "node": "Route by Action", "type": "main", "index": 0 }]]
    },
    "Route by Action": {
      "main": [
        [{ "node": "Generate Statistics", "type": "main", "index": 0 }],
        [{ "node": "Log Event", "type": "main", "index": 0 }],
        [{ "node": "Generate Report", "type": "main", "index": 0 }]
      ]
    },
    "Generate Statistics": {
      "main": [[{ "node": "Format Response", "type": "main", "index": 0 }]]
    },
    "Log Event": {
      "main": [[{ "node": "Format Response", "type": "main", "index": 0 }]]
    },
    "Generate Report": {
      "main": [[{ "node": "Format Response", "type": "main", "index": 0 }]]
    },
    "Format Response": {
      "main": [[{ "node": "Respond to Webhook", "type": "main", "index": 0 }]]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-10-21T00:00:00.000Z",
  "versionId": "analytics-v1"
}
